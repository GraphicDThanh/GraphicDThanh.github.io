---
layout: post
title:  "Iterable, Iterator v√† Generator trong Python"
date:   2020-09-09 10:00:00 +0700
categories: python, dai-ban-doanh-python
---

Ch√†o c·∫£ nh√† ü•≥! Ch√†o BeautyOnCode  ü§£ 

Just for vui t√≠, th·ª±c ra ƒë√≥ l√† c√°ch gia ƒë√¨nh m√¨nh ch√†o nhau d·∫°o g·∫ßn ƒë√¢y lol 

Ba b·∫£o: ‚ÄúCh√†o Minh Ho√†ng!‚Äù. Chicken b·∫£o: ‚ÄúCh√†o Ba L·ªôc!‚Äù . M·∫π √öt b·∫£o: ‚ÄúCh√†o Minh Ho√†ng‚Äù. Chicken b·∫£o: ‚ÄúCh√†o M·∫π √öt‚Äù ü§£

H√¥m nay t·ª•i m√¨nh s·∫Ω c·∫ßm g∆∞∆°ng l√™n, d≈©ng c·∫£m x√¥ng pha ra tr·∫≠n ch√©m con th√∫ hai ƒë·∫ßu, m·ªôt ƒë·∫ßu n√≥ c√≥ m√†u h·ªìng t√™n l√† ‚ÄúIterator‚Äú, m·ªôt ƒë·∫ßu m√†u xanh t√™n l√† ‚ÄúGenerator‚Äú. 

ƒê·ªÉ m√¨nh k·ªÉ b·∫°n nghe, ƒë√¢y l√† m·ªôt c√¢u chuy·ªán c√≥ th·∫≠t, t·ª´ chi·∫øc ti vi, k√™nh Cartoon Network, ch∆∞∆°ng tr√¨nh ho·∫°t h√¨nh ‚ÄúBi·ªát ƒë·ªôi Titan xu·∫•t k√≠ch‚Äù. Hai b·∫°n qu√°i v·∫≠t n√†y ƒë∆∞·ª£c nh·ªët trong m·ªôt c√°i h·ªôp th·∫ßn b√≠, Raven ƒë√£ d·∫∑n c√°c b·∫°n kh√¥ng ƒë∆∞·ª£c m·ªü n√≥ ra v√¨ n√≥ r·∫•t nguy hi·ªÉm, nh∆∞ng StarFire ƒë√£ kh√¥ng ki·ªÅm ƒë∆∞·ª£c t√≤ m√≤ v√† m·ªü ra. Hai b·∫°n n√†y si√™u d·ªÖ th∆∞∆°ng lu√¥n, c√πng vui ch∆°i v·ªõi c√°c b·∫°n nh·ªè, nh∆∞ng khi hai b·∫°n ƒë√≥ ƒë∆∞·ª£c StarFire kh√¥ng ki·ªÅm ƒë∆∞·ª£c m√† h√¥n cho m·ªôt c√°i th√¨ l·∫≠p t·ª©c hai b·∫°n bi·∫øn h√¨nh th√†nh m·ªôt con qu√°i v·∫≠t c√≥ hai ƒë·∫ßu ƒëi ph√° th√†nh ph·ªë. Sau ƒë√≥, StarFire ƒë√£ n√≥i ra nh·ªØng l·ªùi ƒëau l√≤ng ƒë·∫øn m·ª©c t·ª´ con qu√°i v·∫≠t hai ƒë·∫ßu kh·ªïng l·ªì hai b·∫°n c√†ng ng√†y c√†ng thu b√© l·∫°i v√† bi·∫øn th√†nh hai con ti·ªÉu y√™u kh√≥c n·ª©c n·ªü v√¨ kh√¥ng ƒë∆∞·ª£c y√™u th∆∞∆°ng n·ªØa.                        

C√¢u chuy·ªán v·∫≠y ƒë√≥, khi m√¨nh so·∫°n b√†i n√†y t·ª± d∆∞ng m√¨nh th·∫•y c≈©ng tr√πng h·ª£p gh√™, hai b·∫°n ‚ÄúIterator‚Äù v√† ‚ÄúGenerator‚Äù n√†y c≈©ng d·ªÖ th∆∞∆°ng nh∆∞ v·∫≠y, nh∆∞ng c≈©ng c√≥ th·ªÉ bi·∫øn th√†nh qu√°i v·∫≠t khi m√¨nh ch·ªß quan v·ªÅ c√°c b·∫°n ·∫•y ƒë√∫ng kh√¥ng n√†o. C√≤n m√¨nh m√† ƒë√£ hi·ªÉu √°, th√¨ s·∫Ω bi·∫øn l·∫°i th√†nh hai b·∫°n ti·ªÉu y√™u xinh x·∫Øn d·ªÖ c∆∞ng th√¥i.

Cho n√™n l√† h√¥m nay, m√¨nh c√πng quy·∫øt t√¢m chinh ph·ª•c con qu√°i th√∫ hai ƒë·∫ßu n√†y nha! üëª  √ù qu√™n, c√≤n g·∫∑p c·∫£ s∆∞ ph·ª• c·ªßa t·ª•i nh·ªè n·ªØa ƒë·∫•y.

B√†i blog n√†y thu·ªôc series [‚ÄúKh√°m ph√° ƒê·∫°i B·∫£n Doanh Python‚Äù](https://beautyoncode.com/dai-ban-doanh-python-series-overview/).

(Image by [artemtation](https://pixabay.com/users/artemtation-45390/?utm_source=link-attribution&utm_medium=referral&utm_campaign=image&utm_content=948563) from Pixabay)

# M·ªü ƒë·∫ßu
Trong n·ªôi dung b√†i [‚ÄúC√°c c√¥ng c·ª• ƒëi·ªÅu khi·ªÉn lu·ªìng d·ªØ li·ªáu‚Äù](https://beautyoncode.com/control-flow-in-python/), m√¨nh ƒë√£ bi·∫øt c√°ch l·∫∑p qua c√°c ph·∫ßn t·ª≠ c·ªßa c√°c ki·ªÉu d·ªØ li·ªáu l√† t·∫≠p h·ª£p nhi·ªÅu ph·∫ßn t·ª≠ trong ƒë√≥, nh∆∞ l√† string, list, dict r·ªìi, d√πng for ph·∫ßn_t·ª≠ in danh_s√°ch. V√† m√¨nh c≈©ng ƒë√£ h·ªçc c√°ch s·ª≠ d·ª•ng enumerate() ƒë·ªÉ c√≥ th·ªÉ v·ª´a l·∫∑p qua v·ª´a s·ª≠ d·ª•ng ch·ªâ s·ªë index c·ªßa ph·∫ßn t·ª≠, v√≠ d·ª•:

```python
>>> a = ["Thanh", "has", "a", "blog"]
>>> for i, s in enumerate(a):
...     print("chuoi hien tai la:", s)
...     if i < len(a) - 1:
...             print("chuoi tiep theo la:", a[i+1])
...     else:
...             print("day la chuoi cuoi cung!")
...
chuoi hien tai la: Thanh
chuoi tiep theo la: has
chuoi hien tai la: has
chuoi tiep theo la: a
chuoi hien tai la: a
chuoi tiep theo la: blog
chuoi hien tai la: blog
day la chuoi cuoi cung!
>>>
```
‚Äúa‚Äù ƒëang l√† m·ªôt danh s√°ch. N·∫øu a l√† m·ªôt set th√¨ sao nh·ªâ? C√πng xem v√≠ d·ª• ·ªü tr√™n v·ªõi b c√≥ gi√° tr·ªã t∆∞∆°ng t·ª± a nh∆∞ng l√† ki·ªÉu d·ªØ li·ªáu set nh√©. (ƒê·ªçc th√™m v·ªÅ c√°c lo·∫°i d·ªØ li·ªáu ·ªü b√†i [‚ÄúC·∫•u tr√∫c d·ªØ li·ªáu trong Python‚Äù](https://beautyoncode.com/data-structure-in-python/) nh√©)

```python
>>> b = {"Thanh", "has", "a", "blog"}
>>> for i, s in enumerate(b):
...     print("chuoi hien tai la:", s)
...     if i < len(b) - 1:
...             print("chuoi tiep theo la:", b[i+1])
...     else:
...             print("day la chuoi cuoi cung!")
...
chuoi hien tai la: blog
Traceback (most recent call last):
  File "<stdin>", line 4, in <module>
TypeError: 'set' object is not subscriptable
>>>
```

√îi n√≥ b·ªã sao th·∫ø nh·ªâ, l·ªói *‚ÄúTypeError: ‚Äòset‚Äô object is not subscriptable‚Äù* c√≥ nghƒ©a l√† ki·ªÉu d·ªØ li·ªáu ‚Äúset‚Äù kh√¥ng h·ªó tr·ª£ truy c·∫≠p ph·∫ßn t·ª≠ theo ch·ªâ m·ª•c index. 

Hi·ªÉu n√¥m na th√¨ n·∫øu a l√† list, n√≥ c√≥ th·ªÉ truy c·∫≠p ƒë·∫øn ph·∫ßn t·ª≠ ƒë·∫ßu ti√™n b·∫±ng index l√† 0 v·ªõi a[0], c√≤n b l√† set th√¨ n√≥ kh√¥ng c√≥ ch·ªâ s·ªë index nh∆∞ v·∫≠y n√™n b[0] s·∫Ω b√°o l·ªói nh∆∞ tr√™n.

---

Th·∫ø c√≤n ki·ªÉu d·ªØ li·ªáu dict th√¨ sao nh·ªâ? Kh√¥ng bi·∫øt b·∫°n n√†y c√≥ h·ªó tr·ª£ truy c·∫≠p theo ch·ªâ m·ª•c index kh√¥ng ta?

```python
>>> a = {"name": "Thanh", "age": 29}
>>> for i, key in enumerate(a):
...     print("tu khoa: ", key)
...     print(f"gia tri cua tu khoa {key} la: {a[key]}")
...     print(f"gia tri cua a t·∫°i index {i} la: {a[i]}")
...
tu khoa:  name
gia tri cua tu khoa name la: Thanh
Traceback (most recent call last):
  File "<stdin>", line 4, in <module>
KeyError: 0
>>>
```

√öi, v·∫≠y l√† ki·ªÉu d·ªØ li·ªáu dict c≈©ng kh√¥ng truy c·∫≠p theo ch·ªâ m·ª•c index ƒë∆∞·ª£c.

V·∫≠y l√†, trong Python c√πng l√† ki·ªÉu d·ªØ li·ªáu c√≥ th·ªÉ ch·ª©a nhi·ªÅu ph·∫ßn t·ª≠(string, list, set, dict, ‚Ä¶) nh∆∞ng c√°c b·∫°n n√†y l·∫°i chia l√†m **hai nh√≥m**: 

ü•∞  **Nh√≥m d·ªØ li·ªáu tu·∫ßn t·ª±(sequence): string, list, ‚Ä¶** cho ph√©p m√¨nh truy c·∫≠p qua c√°c ph·∫ßn t·ª≠ trong b·ªô s∆∞u t·∫≠p b·∫±ng ch·ªâ m·ª•c, hay g·ªçi l√† s·ªë index, c√°c b·∫°n n√†y c√≥ ch·ªâ s·ªë index ƒë∆∞·ª£c ƒë√°nh d·∫•u t·ª´ 0 ƒë·∫øn len ‚Äì 1(chi·ªÅu d√†i c·ªßa n√≥ tr·ª´ ƒëi 1). 

ü•∞  **Nh√≥m d·ªØ li·ªáu t·∫≠p h·ª£p(collection): set, dict, ‚Ä¶** kh√¥ng truy c·∫≠p ƒë∆∞·ª£c theo ch·ªâ m·ª•c index.

---
R·ªìi sao n·ªØa üòä  Hehe, r·ªìi th√¨ lu·∫≠t sinh ra l√† ƒë·ªÉ l√°ch lu·∫≠t ƒë√≥ m·∫•y b·∫°n üòÖ

Mu·ªën l√°ch lu·∫≠t t·ª©c l√† mu·ªën duy·ªát c√≥ tr√¨nh t·ª± m·∫•y ki·ªÉu d·ªØ li·ªáu t·∫≠p h·ª£p nh∆∞ set, dict tr√™n, th√¨ m√¨nh c·∫ßn hi·ªÉu b·∫£n ch·∫•t v√† c∆° ch·∫ø c·ªßa lu·∫≠t n√†y c√°i ƒë√£. ƒê√¢y ch√≠nh l√† s∆∞ ph·ª• c·ªßa hai b·∫°n ti·ªÉu y√™u tr√™n, t·ªõ t·∫°m g·ªçi l√† s∆∞ ph·ª• **iterable** 

# Iterable

Th·ª±c ra n√£y gi·ªù m√¨nh t·ª´ng g·∫∑p nhi·ªÅu b·∫°n l√† iterable r·ªìi ·∫•y üëâ  **a** v√† **b** c·ªßa nh·ªØng v√≠ d·ª• tr√™n ƒë·ªÅu l√† c√°c iterable.

M·ªôt ƒë·ªëi t∆∞·ª£ng l√† **iterable** nghƒ©a l√† n√≥ c√≥ th·ªÉ l·∫∑p qua, hi·ªÉu n√¥m na n·∫øu **a** l√† m·ªôt **iterable** th√¨:

üëâ  c√≥ th·ªÉ l·∫∑p qua a ƒë∆∞·ª£c, t·ª©c c√≥ th·ªÉ vi·∫øt *‚Äúfor x in a‚Äù *

üëâ  g·ªçi *iter(a)*, s·∫Ω tr·∫£ v·ªÅ m·ªôt iterator

üëâ  a c√≥ ph∆∞∆°ng th·ª©c *\_\_iter\_\_* c≈©ng tr·∫£ v·ªÅ m·ªôt iterator, ho·∫∑c ƒë√¥i khi A c√≥ ph∆∞∆°ng th·ª©c *\\getitem\\* n·∫øu a thu·ªôc nh√≥m d·ªØ li·ªáu tu·∫ßn t·ª≠ c√≥ th·ªÉ truy c·∫≠p ph·∫ßn t·ª≠ theo ch·ªâ s·ªë index ƒë√£ n√≥i ·ªü tr√™n.

Xem v√≠ d·ª• v·ªõi iterable l√† list:

```python
>>> a = ["Thanh", "has", "a", "blog"]]
>>> a = ["BeautyOnCode", "blog"]
>>> for s in a:
...     print(s)
...
BeautyOnCode
blog
>>> iter(a)
<list_iterator object at 0x10b5dbd60>
>>> a.__dir__()
['__repr__', '__hash__', '__getattribute__', '__lt__', '__le__', '__eq__', '__ne__', '__gt__', '__ge__', '__iter__', '__init__', '__len__', '__getitem__', '__setitem__', '__delitem__', '__add__', '__mul__', '__rmul__', '__contains__', '__iadd__', '__imul__', '__new__', '__reversed__', '__sizeof__', 'clear', 'copy', 'append', 'insert', 'extend', 'pop', 'remove', 'index', 'count', 'reverse', 'sort', '__doc__', '__str__', '__setattr__', '__delattr__', '__reduce_ex__', '__reduce__', '__subclasshook__', '__init_subclass__', '__format__', '__dir__', '__class__']
>>> a.__iter__()
<list_iterator object at 0x10b5dbd60>
>>> a.__getitem__(0)
'BeautyOnCode'
>>>
```

Ti·∫øp theo b l√† m·ªôt dict n√®:

```python
>>> b = {"name": "Thanh", "age": 29}
>>> for x in b:
...     print(x)
...
name
age
>>> iter(b)
<dict_keyiterator object at 0x10b61cc20>
>>> b.__dir__()
['__repr__', '__hash__', '__getattribute__', '__lt__', '__le__', '__eq__', '__ne__', '__gt__', '__ge__', '__iter__', '__init__', '__len__', '__getitem__', '__setitem__', '__delitem__', '__contains__', '__new__', '__sizeof__', 'get', 'setdefault', 'pop', 'popitem', 'keys', 'items', 'values', 'update', 'fromkeys', 'clear', 'copy', '__reversed__', '__doc__', '__str__', '__setattr__', '__delattr__', '__reduce_ex__', '__reduce__', '__subclasshook__', '__init_subclass__', '__format__', '__dir__', '__class__']
>>> b.__iter__()
<dict_keyiterator object at 0x10b61cc20>
>>> b.__getitem__(0)
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
KeyError: 0
```

B·∫°n ƒë√£ th·∫•y s·ª± kh√°c nhau ch∆∞a, v·∫≠y l√† ƒëi·ªÉm chung duy nh·∫•t c·ªßa c√°c iterable l√† **c√≥ nhi·ªÅu ph·∫ßn t·ª≠** v√† cho **ph√©p m√¨nh l·∫∑p qua** ch√∫ng n√≥ ƒë·∫•y.

Tuy nhi√™n, s·ªë l∆∞·ª£ng ph·∫ßn t·ª≠ trong iterable c√≥ th·ªÉ l√† h·ªØu h·∫°n ho·∫∑c v√¥ h·∫°n, ·ªü c√°c v√≠ d·ª• tr√™n r√µ l√† ch√∫ng n√≥ c√≥ s·ªë l∆∞·ª£ng h·ªØu h·∫°n. Gi·ªù th√¨ c≈©ng ƒëi qua m·ªôt v√≠ d·ª• v·ªõi s·ªë l∆∞·ª£ng ph·∫ßn t·ª≠ v√¥ h·∫°n nh√©.

![](https://i1.wp.com/beautyoncode.com/wp-content/uploads/2021/05/count-iterable.gif?fit=640%2C430&ssl=1)

Trong v√≠ d·ª• n√†y, m√¨nh s·ª≠ d·ª•ng h√†m **count** t·ª´ [itertools](https://docs.python.org/3/library/itertools.html) ƒë·ªÉ t·∫°o m·ªôt b·ªô ƒë·∫øm l√† b·ªôi c·ªßa 3. 

Khi th·ª±c hi·ªán l·∫∑p qua b·ªô ƒë·∫øm n√†y v·ªõi v√≤ng l·∫∑p for v√† in c√°c ph·∫ßn t·ª≠ ra th√¨ n√≥ s·∫Ω ch·∫°y m√£i m√£i cho ƒë·∫øn khi m√¨nh ng·ª´ng ch∆∞∆°ng tr√¨nh ho·∫∑c m√¨nh ph·∫£i th√™m ƒëi·ªÅu ki·ªán d·ª´ng cho v√≤ng l·∫∑p for l√† khi n > 200 th√¨ tho√°t kh·ªèi v√≤ng l·∫∑p nh∆∞ trong v√≠ d·ª• tr√™n.

V·ªõi s·ªë l∆∞·ª£ng ph·∫ßn t·ª≠ v√¥ h·∫°n nh∆∞ v·∫≠y th√¨ m√¨nh kh√¥ng th·ªÉ chuy·ªÉn c√°c b·∫°n ·∫•y v·ªÅ ki·ªÉu danh s√°ch ƒë∆∞·ª£c. Ch∆∞a k·ªÉ v·ªõi s·ªë l∆∞·ª£ng ph·∫ßn t·ª≠ qu√° l·ªõn s·∫Ω g√¢y h·∫°i cho b·ªô nh·ªõ v√† hi·ªáu su·∫•t c·ªßa ch∆∞∆°ng tr√¨nh.

Hehe, th·ª±c ra t·ªõ chuy·ªÉn th·ª≠ r·ªìi, v√† n√≥ kill lu√¥n PI v√† t·ª± tho√°t ra ngo√†i lu√¥n üòÖ

```python
>>> list(multiples_of_three)
[1]    5953 killed     python
```

V√¨ nh·ªØng nguy√™n nh√¢n ƒë√≥, **s∆∞ ph·ª• Iterable** ƒë√£ nh·∫≠n m·ªôt ƒë·ªá t·ª≠ ƒë·∫ßu ti√™n, ch√≠nh l√† b·∫°n ti·ªÉu y√™u m√†u h·ªìng, b·∫°n m√† sau n√†y bi·∫øn th√†nh qu√°i th√∫ m√†u h·ªìng trong con qu√°i th√∫ hai ƒë·∫ßu ƒë√≥, b·∫°n ·∫•y t√™n l√† Iterator.

C√πng xem b·∫°n Iterator gi√∫p gi·∫£i quy·∫øt v·∫•n ƒë·ªÅ tr√™n ra sao nh√©!

# Iterator
Th·ª±c ra iterator l√† m·ªôt kh√°i ni·ªám trong lƒ©nh v·ª±c khoa h·ªçc m√°y t√≠nh ƒë·∫•y nh√©. [ƒê√¢y](https://en.wikipedia.org/wiki/Iterator) l√† xu·∫•t th√¢n c·ªßa Iterator t·ª´ Wikipedia:

> In computer programming, an **iterator** is an object that enables a programmer to traverse a container, particularly lists.

M√¨nh t·∫°m d·ªãch l√†: Trong lƒ©nh v·ª±c khoa h·ªçc m√°y t√≠nh, m·ªôt iterator l√† m·ªôt ƒë·ªëi t∆∞·ª£ng cho ph√©p c√°c nh√† l·∫≠p tr√¨nh c√≥ th·ªÉ duy·ªát qua m·ªôt v√πng ch·ª©a c√°c d·ªØ li·ªáu, nh∆∞ danh s√°ch.

C√≤n trong Python, iterator ƒë∆∞·ª£c ƒë·ªãnh nghƒ©a trong [Python wiki](https://wiki.python.org/) l√†:

> [iterator](https://wiki.python.org/moin/Iterator) l√† ƒë·ªëi t∆∞·ª£ng c√≥ ph∆∞∆°ng th·ª©c **\_\_next\_\_**, v√† ph∆∞∆°ng th·ª©c n√†y s·∫Ω tr·∫£ v·ªÅ ph·∫ßn t·ª≠ ti·∫øp theo c·ªßa ƒë·ªëi t∆∞·ª£ng, n·∫øu ƒë·ªëi t∆∞·ª£ng kh√¥ng c√≤n ph·∫ßn t·ª≠ n√†o ƒë·ªÉ l·∫∑p qua th√¨ n√≥ s·∫Ω b√°o l·ªói **StopIteration**. 

---

B·∫°n ƒë√£ th·∫•y iterator l·∫ßn n√†o ch∆∞a nh·ªâ? 

Th·ª±c ra m√¨nh ƒë√£ th·∫•y b·∫°n ·∫•y khi m√¨nh g·ªçi iter(a) ·ªü v√≠ d·ª• tr√™n ƒë·∫•y, c√πng xem m√¨nh g·ªçi **\_\_next\_\_** th√¨ b·∫°n ·∫•y s·∫Ω tr·∫£ ra g√¨ nh√©: 

```python
>>> a = ["BeautyOnCode", "blog"]
>>> x = iter(a)
>>> x
<list_iterator object at 0x10b5dbd60>
>>> x.__next__()
'BeautyOnCode'
>>> x.__next__()
'blog'
>>> x.__next__()
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
StopIteration
>>>
```

·ªí hay ch∆∞a, m√¨nh c√≥ th·ªÉ ƒëi qua c√°c ph·∫ßn t·ª≠ trong a b·∫±ng ph∆∞∆°ng th·ª©c **\_\_next\_\_**, thay v√¨ d√πng for n√®. Khi ƒëi ƒë·∫øn ph·∫ßn t·ª≠ cu·ªëi c√πng r·ªìi, th√¨ n√≥ s·∫Ω b√°o l·ªói *StopIteration* ƒë·ªÉ b√°o cho m√¨nh bi·∫øt h·∫øt ƒë·ªì ƒë·ªÉ ƒëi ti·∫øp r·ªìi nghen ü§£ 

Th√™m n·ªØa, **iterator c≈©ng l√† iterable** ƒë√≥, c√πng xem t·ªõ l·∫∑p qua n√≥ v·ªõi for n√®, v√† c·∫£ g·ªçi iter() cho x th√¨ n√≥ tr·∫£ v·ªÅ ch√≠nh n√≥ lu√¥n.

```python
>>> a = ["BeautyOnCode", "blog"]
>>> x = iter(a)
>>> for s in x:
...     print(s)
...
BeautyOnCode
blog
>>> iter(x)
<list_iterator object at 0x10b5a84f0>
>>> x
<list_iterator object at 0x10b5a84f0>
>>>
```

Ra v·∫≠y, ƒë·ªÉ l·∫∑p qua m·ªôt iterable v√¥ h·∫°n, nh∆∞ c√°i v√≠ d·ª• b·ªôi s·ªë c·ªßa 3 ·ªü tr√™n, m√¨nh c·∫ßn bi·∫øn n√≥ th√†nh iterator b·∫±ng h√†m iter(), r·ªìi sau ƒë√≥ c√≥ th·ªÉ d√πng **\_\_next\_\_()** ho·∫∑c **next()** ƒë·ªÉ ƒëi qua l·∫ßn l∆∞·ª£t c√°c ph·∫ßn t·ª≠. Nh∆∞ng v√¨ ƒëang n√≥i ƒë·∫øn iterable v√¥ h·∫°n, cho n√™n n√≥ s·∫Ω kh√¥ng bao gi·ªù c√≥ ngo·∫°i l·ªá StopIteration lu√¥n ·∫•y.

C√πng xem c√°ch m√¨nh ƒë√£ l·∫∑p qua ‚Äú*multiplesofthree*‚Äù d√πng iterator thay cho for nh√©:

![](https://i2.wp.com/beautyoncode.com/wp-content/uploads/2021/05/iterator-example-unlimit.gif?fit=640%2C616&ssl=1)

Th·∫≠t th√∫ v·ªã ƒë√∫ng kh√¥ng n√†o, m√¨nh kh√¥ng d√πng for m√† v·∫´n l·∫∑p qua c√°c ƒë·ªëi t∆∞·ª£ng c·ªßa m·ªôt iterable ƒë·∫•y. 

V√† b·∫≠t m√≠ v·ªõi c√°c b·∫°n, ƒë√¢y c≈©ng ch√≠nh l√† c∆° ch·∫ø l·∫∑p ƒë∆∞·ª£c s·ª≠ d·ª•ng nhi·ªÅu trong Python ƒë·∫•y, c·ª• th·ªÉ l√† cho v√≤ng l·∫∑p for n√®, r·ªìi x√°c ƒë·ªãnh nhi·ªÅu gi√° tr·ªã trong tuple n√®, r·ªìi list comprehension(v√≠ d·ª• cho b·∫°n n√†o qu√™n n√®, [i +1 for i in a]), ‚Ä¶.

Tr∆∞·ªõc khi ƒëi ti·∫øp m√¨nh xin t√≥m t√≥m l·∫°i m·ªôt x√≠u cho b·∫°n ƒë·ª° ng·ª£p nha. 

M√¨nh ƒë√£ t√¨m hi·ªÉu qua v·ªÅ: **Iterable**, **Iterator**

üòä  **Iterable ƒë∆∞·ª£c x√°c ƒë·ªãnh b·∫±ng 3 c√°ch:**

  1. d√πng ƒë∆∞·ª£c v·ªõi for

  2. iter(X) kh√¥ng b√°o l·ªói

  3. c√≥ ph∆∞∆°ng th·ª©c \_\_iter\_\_

üòä  **Iterator ƒë∆∞·ª£c x√°c ƒë·ªãnh b·∫±ng:**

   1. Y = iter(X), v·ªõi X l√† m·ªôt iterable, th√¨ Y l√† m·ªôt iterator

   2. next(Y) s·∫Ω tr·∫£ v·ªÅ gi√° tr·ªã ph·∫ßn t·ª≠ ti·∫øp theo ho·∫∑c ngo·∫°i l·ªá StopIteration, th√¨ Y l√† iterator.

   3. iter(Y) s·∫Ω tr·∫£ v·ªÅ Y, th√¨ Y l√† iterator(t·ª©c iterator c≈©ng ch√≠nh l√† iterable)

Nh√¨n t√≥m t·∫Øt tr√™n b·∫°n th·ª≠ h√¨nh dung xem n·∫øu m√¨nh mu·ªën t·∫°o m·ªôt iterable cho ri√™ng m√¨nh th√¨ m√¨nh c·∫ßn ph·∫£i ƒë·ªãnh nghƒ©a nh·ªØng g√¨ ƒë·ªÉ Python hi·ªÉu n√≥ l√† m·ªôt iterable nh·ªâ?

ƒê·ªÉ xem n√†o, h·∫≥n l√† n√≥ c·∫ßn c√≥ m·ªôt ph∆∞∆°ng th·ª©c l√† **\_\_iter\_\_**, v√† ph∆∞∆°ng th·ª©c n√†y c·∫ßn tr·∫£ v·ªÅ m·ªôt b·∫°n **iterator**.

C√πng m√¨nh th·ª≠ s·ª©c ƒë·ªãnh nghƒ©a m·ªôt iterable c·ªßa ri√™ng b·∫°n nh√©!

---

```python
class BlogPostIterator:
    def __init__(self, blogpost):
        self._blogpost = blogpost
        self._current = 0

    def __next__(self):
        """Tr·∫£ v·ªÅ b·∫°n post ti·∫øp theo nh√©"""
        # S·ªë posts trong blog n√®
        posts = self._blogpost._posts
        if self._current < len(posts):
            # l·∫•y ph·∫ßn t·ª≠ v·ªõi ch·ªâ s·ªï index l√† _current ra nha
            next = posts[self._current]
            # tƒÉng _current l√™n 1 nh√©
            self._current += 1
            return next

        # N·∫øu ch·ªâ s·ªë index v∆∞·ª£t qu√° s·ªë posts c√≥ th√¨
        # la l√†ng ngo·∫°i l·ªá StopIteration
        raise StopIteration

class BlogPost:
    """Posts in blog"""
    def __init__(self):
        self._posts = []

    def add_post(self, posts):
        """Th√™m posts v√†o nh√©"""
        self._posts += posts

    def __iter__(self):
        """Tr·∫£ v·ªÅ iterator nh√©"""
        return BlogPostIterator(self)
```

·ªû tr√™n, l·ªõp BlogPost c√≥ th·ªÉ t·∫°o ra c√°c ƒë·ªëi t∆∞·ª£ng l√† iterable ƒë√≥, c√πng th·ª≠ nghi·ªám nha:

![](https://i1.wp.com/beautyoncode.com/wp-content/uploads/2021/05/custom-iterable-run.gif?fit=640%2C357&ssl=1)

M√¨nh c√≥ th·ª±c h√†nh v√† gi·∫£i th√≠ch ·ªü tr√™n [video n√†y](https://youtu.be/nEIV8lXn1Hs) n√®

Ui, m√£i qu·∫ßn qu·∫≠t v·ªõi hai b·∫°n n√†y m√† m√¨nh s·∫Øp tr·ªÖ th·ªùi gian r·ªìi, nhanh nhanh ƒëi ti·∫øp ƒë·∫øn ch√∫ ti·ªÉu y√™u ti·∫øp theo c·∫ßn ph·∫£i chinh ph·ª•c, ƒë√≥ l√† ch√∫ m√†u xanh **generator** .

# Generator

[ƒê√¢y](https://en.wikipedia.org/wiki/Generator_(computer_programming)) l√† xu·∫•t th√¢n c·ªßa Generator t·ª´ Wikipedia:

> In computer science, a **generator** is a routine that can be used to control the iteration behaviour of a loop. All generators are also iterators.

M√¨nh t·∫°m d·ªãch l√†: Trong lƒ©nh v·ª±c khoa h·ªçc m√°y t√≠nh, m·ªôt generator l√† m·ªôt b·ªô c√°c quy tr√¨nh c√°c c√≥ th·ªÉ d√πng ƒë·ªÉ ki·ªÉm so√°t h√†nh ƒë·ªông c·ªßa m·ªôt v√≤ng l·∫∑p. V√† t·∫•t c·∫£ generator c≈©ng l√† iterators.

C√≤n trong Python, generator ƒë∆∞·ª£c ƒë·ªãnh nghƒ©a trong Python wiki l√†:

[generator](https://wiki.python.org/moin/Generators) hay g·ªçi l√† **h√†m generato**r, cho ph√©p b·∫°n t·∫°o ra m·ªôt h√†m ho·∫°t ƒë·ªông t∆∞∆°ng t·ª± nh∆∞ m·ªôt iterator, t·ª©c l√† n√≥ c≈©ng l√† iterable, v√† c√≥ th·ªÉ d√πng v·ªõi v√≤ng l·∫∑p for.

## D√πng generator trong tr∆∞·ªùng h·ª£p n√†o

M√¨nh l√† m·ªôt b·∫°n nh·ªè hay th·∫Øc m·∫Øc, m√¨nh c≈©ng r·∫•t t√≤ m√≤ l√Ω do v√¨ sao c·∫ßn c√≥ h√†m generator ·∫•y nh·ªâ? N√≥ c≈©ng t·∫°o ra iterator ƒë√∫ng hem, th·∫ø sao kh√¥ng d√πng lu√¥n iterator th√¥i nh·ªâ?

B·∫°n ƒëo√°n th·ª≠ c√πng m√¨nh xem sao? 

M√¨nh nghƒ© l√† n·∫øu t·∫°o m·ªôt iterator khoai nh∆∞ ·ªü tr√™n, th√¨ bu·ªìn th·∫≠t ƒë·∫•y, khi n√†o c≈©ng vi·∫øt ph∆∞∆°ng th·ª©c **\_\_iter\_\_** r·ªìi n√≥ ph·∫£i tr·∫£ v·ªÅ iterator, r·ªìi mu·ªën tr·∫£ v·ªÅ iterator th√¨ l·∫°i ph·∫£i ƒëi ƒë·ªãnh nghƒ©a ph∆∞∆°ng th·ª©c **\_\_next\_\_** v√† vi·∫øt c√°i logic kh√°c n·ªØa. Th·∫≠t t√¨nh m√† n√≥i th√¨ c≈©ng h∆°i kh√≥ g·∫∑m ƒë√≥ nha ü•≤.

H·∫≥n l√† m·∫•y ch√∫ Python th·∫•y th·∫ø b√®n nghƒ© ra m·ªôt c√°ch, hay l√† m√¨nh cho t·ª•i nh·ªè vi·∫øt m·ªôt h√†m th√¥i, v√† h√†m ƒë√≥ ho·∫°t ƒë·ªông nh∆∞ l√† m·ªôt iterator, c√≤n nh·ªØng th·ª© l·∫±ng nh·∫±ng kia h√£y ƒë·ªÉ c√°c ch√∫ lo, ph·∫£i kh√¥ng? ü•∞

Hihi, ƒëo√°n b·∫≠y v·∫≠y m√† n√≥ tr√∫ng r·ªìi nha, ch√≠nh x√°c l√† generator gi√∫p m√¨nh t·∫°o iterator m·ªôt c√°ch d·ªÖ d√†ng h∆°n nhi·ªÅu. V√† th√™m n·ªØa, generator s·∫Ω th∆∞·ªùng s·ª≠ d·ª•ng cho c√°c tr∆∞·ªùng h·ª£p c·∫ßn c√¢n nh·∫Øc v·ªÅ chuy·ªán hi·ªáu su·∫•t c·ªßa ch∆∞∆°ng tr√¨nh, v√≠ d·ª• nh∆∞ l√† khi m√¨nh l√†m vi·ªác v·ªõi s·ªë si√™u l·ªõn, hay l√†m vi·ªác v·ªõi c√°c file c√≥ dung l∆∞·ª£ng l·ªõn c·∫ßn x·ª≠ l√Ω.

V√¨ sao? V√¨ khi ƒë√≥ n·∫øu d√πng m·ªôt ki·ªÉu d·ªØ li·ªáu tu·∫ßn t·ª± ƒë·ªÉ l∆∞u hay x·ª≠ l√Ω th√¨ ch∆∞∆°ng tr√¨nh s·∫Ω ng·ªën nhi·ªÅu dung l∆∞·ª£ng RAM, d·∫´n ƒë·∫øn tr√†n RAM v√† g√¢y l·ªói v·ªÅ b·ªô nh·ªõ(*Memory Error*). 

N·∫øu b·∫°n g·∫∑p c√°c tr∆∞·ªùng h·ª£p n√†y, th√¨ generator ch√≠nh l√† ch√¢n √°i c·ªßa ƒë·ªùi b·∫°n ƒë√≥, nh·ªõ nh√© üòò

## V√≠ d·ª• gi√πm c√°i

**ƒê·ªÅ b√†i:** t·∫°o m·ªôt danh s√°ch c√°c s·ªë t·ª´ 0 ƒë·∫øn n, sau ƒë√≥ t√≠nh t·ªïng c·ªßa ch√∫ng n√≥. H√£y th·ª≠ nghi·ªám v·ªõi n = 1000000000 nh√©.

N√†o, gi·ªù m√¨nh s·∫Ω ƒëi c√πng v·ªõi m·ªçi ng∆∞·ªùi gi·∫£i b√†i to√°n b·∫±ng ba c√°ch nh√©

### C√°ch 1: d√πng m·ªôt danh s√°ch ƒë·ªÉ l∆∞u c√°c s·ªë.

```python
def list_n_list(n):
    num, nums = 0, []
    while num < n:
        nums.append(num)
        num += 1
        return nums

sum(list_n_list(1000000000))
```

V√† m√¨nh ch·∫°y th·ª≠ xem n√≥ t·ªën bao nhi√™u time:

```python
$ python list_n_list.py     
time execute 0:06:51.453351
```

R·ªìi, ƒëo·∫°n code n√†y kh√° l√† ƒë∆°n gi·∫£n ph·∫£i kh√¥ng, logic r·∫•t d·ªÖ hi·ªÉu, nh∆∞ng n√≥ ƒëang t·∫°o m·ªôt list v·ªõi t·∫•t c·∫£ c√°c ph·∫ßn t·ª≠ t·ª´ 0 ƒë·∫øn n, r·ªìi c·ªông l·∫°i. R√µ l√† ph∆∞∆°ng √°n n√†y nh√¨n th√¨ ƒë∆°n gi·∫£n, nh∆∞ng r·∫•t kh√≥ ch·∫•p nh·∫≠n trong tr∆∞·ªùng h·ª£p n l√† m·ªôt s·ªë si√™u l·ªõn, v√¨ l√†m sao m√† m√¨nh l∆∞u t·∫•t c·∫£ 1000000000‚Ä¶ ph·∫ßn t·ª≠ trong b·ªô nh·ªõ ƒë∆∞·ª£c. 

V·ªõi n = 1000000000000000, ch∆∞∆°ng tr√¨nh s·∫Ω b·ªã ƒë·ª©ng sau m·ªôt h·ªìi c·ªë g·∫Øng hiu hiu, th∆∞∆°ng gh√™!

```python
$ python generator.py
[1]    2247 killed     python generator.py
```


### C√°ch 2: d√πng iterator

ƒê·∫ßu ti√™n, m√¨nh s·∫Ω ti·∫øp c·∫≠n c√°ch s·ªë 2 v·ªõi b·∫°n iterator tr∆∞·ªõc nha, v√¨ b·∫°n n√†y c≈©ng gi√∫p m√¨nh kh√¥ng l∆∞u c·∫£ d√£y nh∆∞ ·ªü tr√™n, v√† v·∫´n c√≥ th·ªÉ x·ª≠ l√Ω trong t√¨nh hu·ªëng n√†y ha.

√îk√™, v√¨ b·∫°n ni h∆°i c·ª±c, n√™n m√¨nh l·∫°i nh·∫Øc x√≠u l√† m√¨nh t√≠nh l√†m g√¨ nha. ƒê·∫ßu ti√™n l√† m√¨nh c·∫ßn t·∫°o m·ªôt l·ªõp c√≥ ph∆∞∆°ng th·ª©c **\_\_iter\_\_** sau ƒë√≥ ph∆∞∆°ng th·ª©c n√†y tr·∫£ ra iterator, ·ªü ƒë√¢y l√† m√¨nh mu·ªën gom h·∫øt v√†o m·ªôt ch·ªó lu√¥n, v√¨ m√¨nh hi·ªÉu l√† iterator c≈©ng l√† iterable n√™n m√¨nh s·∫Ω return self ·ªü ƒë√¢y. Sau ƒë√≥ m√¨nh s·∫Ω t·∫°o ti·∫øp m·ªôt ph∆∞∆°ng th·ª©c **\_\_next\_\_** ƒë·ªÉ self ch√≠nh l√† iterator. 

C√πng xem code nha:

```python
class list_n_iterator(object):
    def __init__(self, n):
        # gi·ªõi h·∫°n l√† n
        self.n = n
        # b·∫Øt ƒë·∫ßu t·ª´ 0
        self.next = 0

    def __iter__(self):
        # list_n v·ª´a l√† iterable, v·ª´a l√† iterator
        # v√¨ n√≥ c√≥ ph∆∞∆°ng th·ª©c __iter__ v√† __next__
        return self

    def __next__(self):
        if self.next < self.n:
            # g√°n gi√° tr·ªã hi·ªán t·∫°i c·ªßa next
            current = self.next
            # tƒÉng 1 cho next
            self.next = current + 1
            return current
        raise StopIteration

sum(list_n_iterator(100000000))
```

C√≤n ƒë√¢y l√† th·ªùi gian ch·∫°y c·ªßa ƒëo·∫°n code v·ªõi iterator nh√©:

```python
$ python list_n_iterator.py  
time execute 0:06:08.411233
```

V√† t·∫•t nhi√™n l√† ƒëo·∫°n code tr√™n c√≥ th·ªÉ ho·∫°t ƒë·ªông ·ªïn h∆°n r·ªìi. 

Tuy nhi√™n c√≥ v√†i v·∫•n ƒë·ªÅ m√† m√¨nh t·ª´ng ƒëo√°n tr∆∞·ªõc ƒë√¢y nh∆∞ l√†:

‚Äì Nhi·ªÅu code qu√°, g·ªìm l·ªõp r·ªìi ph∆∞∆°ng th·ª©c, ‚Ä¶

‚Äì V√† logic kh√° r·ªëi, tr·ª´ khi b·∫°n hi·ªÉu s√¢u v·ªÅ iterator, iterable c√≤n kh√¥ng th√¨ nh√¨n v√†o ƒë√£ hoa m·∫Øt r·ªìi

Ch∆∞a h·∫øt, n·∫øu d√πng ƒëo·∫°n code n√†y l·∫°i ·ªü nhi·ªÅu n∆°i s·∫Ω l√†m cho code c√†ng d√†i h∆°n ƒë·∫•y. V√¨ th·∫ø, Python ƒë√£ h·ªó tr·ª£ m√¨nh b·∫°n generator, b·∫°n n√†y ƒë∆∞·ª£c gi·ªõi thi·ªáu t·ª´ [PEP255](https://www.python.org/dev/peps/pep-0255/).


C√°ch 3: d√πng ng∆∞·ªùi anh h√πng generator, ch√¢n √°i khi l√†m vi·ªác v·ªõi s·ªë l·ªõn v√† d·ªØ li·ªáu l·ªõn

C√πng vi·∫øt l·∫°i code tr√™n v·ªõi generator nh√©! B·∫°n s·∫Ω ng·∫°c nhi√™n v√¨ ƒë·ªô thanh l·ªãch c·ªßa n√≥ ƒë·∫•y!

```python
def list_n_generator(n):
    num = 0
    while num < n:
        yield num
        num += 1

sum(list_n_generator(1000000000))
```

V√† th·ªùi gian c·ªßa b·∫°n n√†y ch·∫°y l√†:

```python
$ python list_n_generator.py                                            
time execute 0:02:07.852190
```

*L∆∞u √Ω nh·ªè l√† th·ªùi gian ch·ªâ mang t√≠nh ch·∫•t so s√°nh kh√°ch quan th√¥i nha, v√¨ n√≥ c√≤n ph·ª• thu·ªôc v√†o m√°y c·ªßa t·ªõ n·ªØa √Ω. *

## C√°ch t·∫°o generator

### C√°ch 1: D√πng h√†m generator

ƒê√¢y ch√≠nh l√† c√°ch m√† v√≠ d·ª• ·ªü tr√™n d√πng ƒë·∫•y. 

ƒê·ªÉ t·∫°o h√†m generator th√¨ m√¨nh t·∫°o h√†m nh∆∞ b√¨nh th∆∞·ªùng v√† thay v√¨ d√πng return ƒë·ªÉ tr·∫£ v·ªÅ gi√° tr·ªã th√¨ m√¨nh d√πng yield ƒë·ªÉ tr·∫£ v·ªÅ gi√° tr·ªã.

### C√°ch 2: D√πng bi·ªÉu th·ª©c generator

Ngo√†i ra c√≤n c√≥ th·ªÉ d√πng bi·ªÉu th·ª©c generator ƒë·ªÉ t·∫°o n·ªØa, bi·ªÉu th·ª©c n√†y t∆∞∆°ng t·ª± nh∆∞ list comprehension ·∫•y, m√† thay d·∫•u [] b·∫±ng d·∫•u () th√¥i

```python
>>> list_odds = [1, 3, 5, 7, 9]
>>> (x**2 for x in list_odds)
<generator object <genexpr> at 0x10b914b30>
```

V·∫≠y l√† h√¥m nay m√¨nh ƒë√£ c√πng g·∫∑p qua s∆∞ ph·ª• iterable, v√† chi·∫øn ƒë·∫•u v·ªõi hai b·∫°n ti·ªÉu y√™u **iterator** v√† **generator** r·ªìi. B·∫°n qu√°i th√∫ hai ƒë·∫ßu n√†y d√π c√≥ s·ª± gi√∫p s·ª©c c·ªßa s∆∞ ph·ª• **iterable** n·ªØa nh∆∞ng v·∫´n ƒë·∫ßu h√†ng tr∆∞·ªõc s·ª± c·ªë g·∫Øng c·ªßa t·ª•i m√¨nh v√† c·∫£ ba ƒë·ªÅu bi·∫øn th√†nh c√°c b·∫°n ti·ªÉu y√™u xinh x·∫Øn r·ªìi ƒë√≥. ü•≥

Nh·ªØng kh√°i ni·ªám n√†y d·ªÖ g√¢y nh·∫ßm l·∫´n n√™n m√¨nh v√† c√°c b·∫°n h√£y ch√∫ √Ω khi s·ª≠ d·ª•ng nha.
