---
layout: post
title:  "Kh√¥ng gian t√™n(namespace) v√† ph·∫°m vi(scope) trong Python"
date:   2021-06-16 10:00:00 +0700
categories: python, dai-ban-doanh-python
---

Khi m√¨nh ng·ªìi h·ªçc v√† d·ªãch b√†i ["Class trong Python"](https://docs.python.org/3/tutorial/classes.html) cho s√™-ri ["Kh√°m Ph√° ƒê·∫°i B·∫£n Doanh Python"](https://viblo.asia/s/kham-pha-dai-ban-doanh-python-OVlYq8Ozl8W), m√¨nh ƒë√£ ƒë·ª•ng hai b·∫°n n√†y, v√† c√°c b·∫°n th·∫≠t l√† tr·ª´u t∆∞·ª£ng v√† kh√≥ g·∫∑m. Th·∫ø l√† m√¨nh t√¨m ki·∫øm v√† vi·∫øt b√†i n√†y ƒë·ªÉ hi·ªÉu r√µ h∆°n v·ªÅ hai b·∫°n ·∫•y, hi v·ªçng b·∫°n ƒë·ªçc th√™m ƒë·ªÉ hi·ªÉu v·ªÅ Python nh√©.

## Kh√¥ng gian t√™n l√† g√¨?

Kh√¥ng gian t√™n(namespace) l√† m·ªôt kh√¥ng gian ch·ª©a c√°c t√™n =)) 

Th·∫≠t ƒë√≥, t√™n l√† c√°c ƒë·ªãnh danh, v√† kh√¥ng gian l√† c√°c c·∫•u tr√∫c hay c√°c t·ªï ch·ª©c, ho·∫∑c hi·ªÉu ƒë∆°n gi·∫£n n√≥ l√† m·ªôt v√πng n√†o ƒë√≥.  

Kh√¥ng gian t√™n trong Python gi·ªëng nh∆∞ l√† b·∫£ng ph√¢n c√¥ng theo d√µi c√¥ng vi·ªác c·ªßa m·ªôt nh√≥m ng∆∞·ªùi v·∫≠y ƒë√≥. B·∫£ng ph√¢n c√¥ng th√¨ theo d√µi t√™n ng∆∞·ªùi, c√≤n kh√¥ng gian t√™n trong Python th√¨ theo d√µi t√™n c√°c ƒë·ªëi t∆∞·ª£ng.

*Th·∫ø ƒë·ªëi t∆∞·ª£ng trong Python l√† g√¨ nh·ªâ?*

C√≥ th·ªÉ b·∫°n ƒë√£ bi·∫øt, m·ªçi th·ª© trong Python ƒë·ªÅu l√† ƒë·ªëi t∆∞·ª£ng. Khi m√¨nh vi·∫øt ch∆∞∆°ng tr√¨nh Python, ch√∫ng ta ƒë·ªãnh nghƒ©a c√°c l·ªõp v√† m√¥-ƒëun; s·ª≠ d·ª•ng c√°c c·∫•u tr√∫c list, dict; c√°c th·ª±c th·ªÉ v√† c√°c h√†m.  T·∫•t c·∫£ b·ªçn ch√∫ng ƒë·ªÅu l√† ƒë·ªëi t∆∞·ª£ng c·∫£ ƒë√≥.

Kh√¥ng gian t√™n trong Python th√¨ theo d√µi t√™n c√°c ƒë·ªëi t∆∞·ª£ng, ch·∫≥ng h·∫°n nh∆∞ c√°c nh∆∞ c√°c th·ª±c th·ªÉ c·ªßa ƒë·ªëi t∆∞·ª£ng v√† c√°c h√†m ch·ª©c nƒÉng. D∆∞·ªõi ƒë√¢y l√† v√†i ƒë·∫∑c ƒëi·ªÉm quan tr·ªçng c·ªßa kh√°i ni·ªám n√†y:

### Kh√¥ng gian t√™n th·ªÉ hi·ªán ·ªü d·∫°ng t·ª´ ƒëi·ªÉn

V√¨ kh√¥ng gian t√™n th·ªÉ hi·ªán √°nh x·∫° gi·ªØa t√™n v√† ƒë·ªëi t∆∞·ª£ng, do ƒë√≥ ki·ªÉu d·ªØ li·ªáu c√≥ th·ªÉ th·ªÉ hi·ªán tham chi·∫øu n√†y ch√≠nh l√† t·ª´ ƒëi·ªÉn(dict), v√¨ b·∫°n ·∫•y c≈©ng c√≥ d·∫°ng tham chi·∫øu key-value.

V√≠ d·ª• v·ªÅ kh√¥ng gian t√™n b·∫±ng g·ªçi h√†m globals(), locals():

```python
>>> a = [1, 2, 3, 4, 5]
>>> 
>>> def foo():
...     b = 11
...     print(locals())
... 
>>> class Student:
...     pass
... 
>>> student = Student()
>>> print(globals())
{'__name__': '__main__', '__doc__': None, '__package__': None, '__loader__': <class '_frozen_importlib.BuiltinImporter'>, '__spec__': None, '__annotations__': {}, '__builtins__': <module 'builtins' (built-in)>, 'a': [1, 2, 3, 4, 5], 'b': 'Hello World!', 'foo': <function foo at 0x101fd93b0>, 'foo0': <function foo at 0x10200c7a0>, 'foo1': <function foo at 0x10200c7a0>, 'tracked_namespaces': {'local': {}}, 'tracked_keys': dict_keys(['local']), 'ns': <module 'namespaces_student' from '/Users/ycui/PythonProjects/namespaces_student.py'>, 'working_hard': True, 'Student': <class '__main__.Student'>, 'Teacher': <class 'namespaces_teacher.Teacher'>, 'student': <__main__.Student object at 0x102027490>}
>>> foo()
{'b': 11}
```

H√†m d·ª±ng s·∫µn **globals()** d√πng ƒë·ªÉ xem c√°c ƒë·ªãnh danh ƒëi k√®m v·ªõi c√°c ƒë·ªëi t∆∞·ª£ng t∆∞∆°ng ·ª©ng c·ªßa ch√≠nh trong kh√¥ng gian t√™n hi·ªán t·∫°i. K·∫øt qu·∫£ l√† danh s√°ch c√°c ƒë·ªëi t∆∞·ª£ng ƒë∆∞·ª£c ƒë·ªãnh nghƒ©a nh∆∞ list, function, class hay th·ª±c th·ªÉ v√† c√°c h√†m d·ª±ng s·∫µn.

B√™n c·∫°nh globals() ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ theo d√µi c√°c ƒë·ªëi t∆∞·ª£ng trong m√¥-ƒëun nh∆∞ ·ªü kh√¥ng gian t√™n to√†n c·ª•c nh∆∞ tr√™n, ch√∫ng ta c√≤n c√≥ th·ªÉ d√πng **locals()** l√† h√†m theo d√µi c√°c ƒë·ªëi t∆∞·ª£ng trong m·ªôt h√†m n√†o ƒë√≥ nh∆∞ l√† kh√¥ng gian t√™n ƒë·ªãa ph∆∞∆°ng c·ªßa h√†m ƒë√≥. Trong v√≠ d·ª•, bi·∫øn ƒë·ªãa ph∆∞∆°ng b ƒë∆∞·ª£c theo d√µi trong kh√¥ng gian t√™n ƒë·ªãa ph∆∞∆°ng c·ªßa h√†m foo.

### Kh√¥ng gian t√™n c√≥ t√≠nh linh ho·∫°t

Kh√¥ng gian t√™n ƒë∆∞·ª£c d√πng ƒë·ªÉ theo d√µi c√°c ƒë·ªëi t∆∞·ª£ng. 

Trong Python code, ch√∫ng ta t·∫°o ra c√°c ƒë·ªëi t∆∞·ª£ng c·ªë ƒë·ªãnh v√† xo√° c√°c ƒë·ªëi t∆∞·ª£ng kh√¥ng c√≤n ƒë∆∞·ª£c d√πng n·ªØa, do ƒë√≥ kh√¥ng gian t√™n c≈©ng s·∫Ω thay ƒë·ªïi theo d·ª±a tr√™n c√°c thao t√°c n√†y.

C√πng xem v√≠ d·ª• khi th·ª±c hi·ªán thao t√°c th√™m v√† xo√° c√°c thu·ªôc t√≠nh s·∫Ω l√†m thay ƒë·ªïi kh√¥ng gian t√™n:

```python
>>> a = [1, 2, 3, 4, 5]
>>> print(globals().keys())
dict_keys(['__name__', '__doc__', '__package__', '__loader__', '__spec__', '__annotations__', '__builtins__', 'a'])
>>> b, c = 'Hi', (1, 2)
>>> print(globals().keys())
dict_keys(['__name__', '__doc__', '__package__', '__loader__', '__spec__', '__annotations__', '__builtins__', 'a', 'b', 'c'])
>>> del c
>>> print(globals().keys())
dict_keys(['__name__', '__doc__', '__package__', '__loader__', '__spec__', '__annotations__', '__builtins__', 'a', 'b'])
```

Khi m·ªôt h√†m ƒë∆∞·ª£c g·ªçi, n√≥ t·∫°o ra m·ªôt kh√¥ng gian t√™n c·ª•c b·ªô, v√† kh√¥ng gian t√™n n√†y s·∫Ω m·∫•t ƒëi khi h√†m ho√†n th√†nh nhi·ªám v·ª• c·ªßa m√¨nh(tr·∫£ v·ªÅ gi√° tr·ªã ho·∫∑c raise l·ªói). Khi ƒë√≥, kh√¥ng gian t√™n c≈©ng s·∫Ω b·ªã thay ƒë·ªëi.

### Ph·∫°m vi l√† h√†ng r√†o c·ªßa kh√¥ng gian t√™n

ƒê·ªÉ cho d·ªÖ h√¨nh dung, b·∫°n c√≥ th·ªÉ nghƒ© ƒë·∫øn scope nh∆∞ l√† h√†ng r√†o quanh nh√† b·∫°n, c√≤n namespace l√† to√†n b·ªô ƒë·∫•t trong ƒë√≥, v√† tr√™n ƒë·∫•t c√≥ th·ªÉ bao g·ªìm c√¢y c·ªëi, nh√† c·ª≠a, .... l√† c√°c ƒë·ªëi t∆∞·ª£ng.

![](https://i0.wp.com/beautyoncode.com/wp-content/uploads/2021/01/namespace-scope-pyhon-1.png)

B·∫°n th·∫•y kh√¥ng, kh√¥ng gian t√™n theo d√µi c√°c ƒë·ªëi t∆∞·ª£ng trong m√¥-ƒëun n√†y, v√¨ t·ª•i n√†y n·∫±m trong kh√¥ng gian c·ªßa n√≥, c√≤n ph·∫°m vi ch√≠nh l√† ƒë∆∞·ªùng m√†u cam th·ªÉ hi·ªán h√†ng r√†o b·ªçc ngo√†i kh√¥ng gian t√™n n√†y. 

N√≥i c√°ch kh√°c, n·∫øu m√¨nh mu·ªën s·ª≠ d·ª•ng attr0 n·∫±m trong m√¥-ƒëun ·ªü tr√™n ·ªü m·ªôt h√†m ‚Äúbo‚Äù ch·∫≥ng h·∫°n, n·∫øu h√†m n√†y kh√¥ng th·ªÉ truy c·∫≠p v√†o ph·∫°m vi n√†y th√¨ kh√¥ng th·ªÉ d√πng bi·∫øn ƒë√≥ ƒë∆∞·ª£c.

C√πng xem m·ªôt v√≠ d·ª• nh√©:

ƒê√¢y l√† code trong file namespace_student.py

```python
working_hard = True

class Student:
   def study(self):
      print("I'm studing.")
```

Truy c·∫≠p v√†o tr√¨nh bi√™n d·ªãch PI:

```python
>>> print(f'working_hard: {working_hard}')
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
NameError: name 'working_hard' is not defined
>>> import namespace_student as ns
>>> print(f'working_hard: {ns.working_hard}')
working_hard: True
>>> print(globals())
{'__name__': '__main__', '__doc__': None, '__package__': None, '__loader__': <class '_frozen_importlib.BuiltinImporter'>, '__spec__': None, '__annotations__': {}, '__builtins__': <module 'builtins' (built-in)>, 'ns': <module 'namespace_student' from '/Users/thanhnguyen/Desktop/namespace/namespace_student.py'>}
```

Khi m√¨nh l√†m vi·ªác trong PI, m√¥-ƒëun m·∫∑c ƒë·ªãnh ·ªü ƒë√¢y l√† main, n∆°i kh√¥ng gian t√™n c√≥ `__main__` l√† gi√° tr·ªã c·ªßa `__name__`.

D√≤ng ƒë·∫ßu ti√™n print, m√¨nh kh√¥ng th·ªÉ truy c·∫≠p v√†o bi·∫øn working_hard v√¨ t·ª•i m√¨nh ƒëang kh√¥ng ƒë·ª©ng trong m√¥-ƒëun namespace_student. Tuy nhi√™n, sau khi m√¨nh n·∫°p m√¥-ƒëun n√†y v√†o, th√¨ m√¨nh c√≥ th·ªÉ truy c·∫≠p t√™n n√†y kh√¥ng qua t√™n m√¥-ƒëun c·ªßa n√≥ v√¨ ns ƒë√£ thu·ªôc kh√¥ng gian t√™n n∆°i m√¨nh ƒëang ƒë·ª©ng(main). M√¨nh c√≥ th·ªÉ ki·ªÉm tra ƒëi·ªÅu ƒë√≥ b·∫±ng h√†m in ra kh√¥ng gian t√™n globals nh∆∞ ·ªü tr√™n.

V√¨ m√¨nh c√≥ th·ªÉ d√πng t√™n c·ªßa m√¥-ƒëun ƒë·ªÉ truy c·∫≠p v√†o c√°c thu·ªôc t√≠nh trong ƒë√≥, cho n√™n ·ªü c√°c m√¥-ƒëun kh√°c nhau ho√†n to√†n c√≥ th·ªÉ ch·ª©a c√°c t√™n gi·ªëng nhau.

B·∫°n c√≥ th·ªÉ h√¨nh dung n√≥ ki·ªÉu nh∆∞ l√† nh√† m√¨nh c√≥ m·ªôt c√°i macbook, nh√† h√†ng x√≥m c≈©ng c√≥ m·ªôt c√°i macbook y nh∆∞ v·∫≠y, th√¨ hai c√°i macbook n√†y m√¨nh c√≥ th·ªÉ ho√†n to√†n ph√¢n bi·ªát ƒë∆∞·ª£c ƒë√∫ng kh√¥ng n√†o üòÄ

![](https://i0.wp.com/beautyoncode.com/wp-content/uploads/2021/01/namespace-scope-pyhon-2.png?w=1280&ssl=1)

### Kh√¥ng gian t√™n v√† ph·∫°m vi ƒë·ªÅu ph√¢n c·∫•p

B·∫°n c√≥ ƒë·ªÉ √Ω th·∫•y ch·ªâ c·∫ßn truy c·∫≠p v√†o tr√¨nh bi√™n d·ªãch l√† m√¨nh c√≥ th·ªÉ s·ª≠ d·ª•ng c√°c h√†m d·ª±ng s·∫µn c·ªßa Python nh∆∞ print() hay c√°c ki·ªÉu d·ªØ li·ªáu nh∆∞ dict(), list(). 

V·∫≠y c√°c b·∫°n n√†y t·ª´ ƒë√¢u ra th·∫ø nh·ªâ ? V√¢ng, c√°c b·∫°n n√†y thu·ªôc kh√¥ng gian t√™n d·ª±ng s·∫µn(built-in) ƒë√≥ ·∫°.

C√≤n khi t·∫°o m·ªôt m√¥-ƒëun, ta s·∫Ω c√≥ kh√¥ng gian t√™n to√†n c·ª•c(global) c·ªßa m√¥-ƒëun ƒë√≥, khi t·∫°o m·ªôt h√†m m√¨nh c√≥ kh√¥ng gian t√™n c·ª•c b·ªô(local) c·ªßa h√†m ƒë√≥. Khi c√°c kh√¥ng gian t√™n ƒë∆∞·ª£c t·∫°o th√¨ c√°c ph·∫°m vi t∆∞∆°ng ·ª©ng c·ªßa ch√∫ng c≈©ng ƒë∆∞·ª£c t·∫°o.

> **ƒê·∫∑c ƒëi·ªÉm quan tr·ªçng c·ªßa kh√¥ng gian t√™n l√† ch√∫ng c√≥ m·ªëi quan h·ªá ph√¢n c·∫•p nh∆∞ v·∫≠y.** 

Bi·ªÉu ƒë·ªì d∆∞·ªõi th·ªÉ hi·ªán s·ª± ph√¢n c·∫•p n√†y: kh√¥ng gian t√™n v√† ph·∫°m vi d·ª±ng s·∫µn bao tr√πm kh√¥ng gian t√™n v√† ph·∫°m vi to√†n c·ª•c, v√† l·ªõp n√†y bao tr√πm kh√¥ng gian t√™n v√† ph·∫°m vi c·ª•c b·ªô.

![](https://i2.wp.com/beautyoncode.com/wp-content/uploads/2021/01/namespace-scope-pyhon-3.png?w=1280&ssl=1)

### Hi·ªÉu lu·∫≠t LEGB

V√¨ ph·∫°m vi x√°c ƒë·ªãnh vi·ªác c√≥ th·ªÉ truy c·∫≠p ƒë·ªëi t∆∞·ª£ng trong m·ªôt ranh gi·ªõi nh·∫•t ƒë·ªãnh v√† ch√∫ng c√≥ t√≠nh ph√¢n c·∫•p nh∆∞ tr√™n, nh·ªØng ƒëi·ªÅu n√†y d·∫´n ƒë·∫øn vi·ªác ch√∫ng c·∫ßn hi·ªÉu v√† n·∫Øm quy lu·∫≠t **LEGB** ‚Äì m·ªôt nguy√™n t·∫Øc gi√∫p x√°c ƒë·ªãnh th·ª© t·ª± c√°c ph·∫°m vi.

LEGB l√† vi·∫øt t·∫Øc c·ªßa c√°c ph·∫°m vi **local**, **enclosing**, **global** v√† **built-in**.

·ªû tr√™n, m√¨nh c√≥ ƒë·ªÅ c·∫≠p ƒë·∫øn c√°c lo·∫°i ph·∫°m vi: local, global, built-in r·ªìi. Th·∫ø c√≤n ph·∫°m vi bao quanh(enclosing) nghƒ©a l√† g√¨ nh·ªâ?

C√πng nh√¨n v√≠ d·ª• sau v·ªÅ ph·∫°m vi bao quanh nha:

![](https://i1.wp.com/beautyoncode.com/wp-content/uploads/2021/01/1_NrD4tbuRGT1yLy9gNezGng.png?w=1280&ssl=1)

·ªû v√≠ d·ª• tr√™n, m√¨nh c√≥ h√†m *outer_function* c√≥ h√†m b√™n trong l√† *inner_function*, h√†m n√†y c√≥ ph·∫°m vi c·ª•c b·ªô c·ªßa ri√™ng n√≥. V·ªõi h√†m *inner_function*, ph·∫°m vi c·ªßa h√†m *outer_function* g·ªçi l√† **ph·∫°m vi bao quanh**(enclosing scope), t·ª©c n√≥ b·ªçc lu√¥n h√†m b√™n trong.

Do ƒë√≥ khi h√†m *inner_function* ƒë∆∞·ª£c goi, d√π local scope c·ªßa n√≥ kh√¥ng c√≥ hai bi·∫øn a, b, nh∆∞ng tr√¨nh th√¥ng d·ªãch ti·∫øp t·ª•c t√¨m ki·∫øm ·ªü enclosing scope v√† t√¨m ƒë∆∞·ª£c hai bi·∫øn n√†y, do ƒë√≥ k·∫øt qu·∫£ tr√™n ƒë∆∞·ª£c hi·ªÉn th·ªã ba bi·∫øn a, b, c.

N·∫øu kh√¥ng th·ªÉ t√¨m th·∫•y bi·∫øn c·∫ßn t√¨m kh√¥ng enclosing scope, ch∆∞∆°ng tr√¨nh s·∫Ω ti·∫øp t·ª•c t√¨m ki·∫øm ·ªü global scope c·ªßa m√¥-ƒëun v√† n·∫øu kh√¥ng c√≥ n·ªØa s·∫Ω t√¨m ki·∫øm t·ªõi built-in scope.

N·∫øu t√¨m h·∫øt b·ªën scope m√† v·∫´n kh√¥ng t√¨m ra th√¨ ch∆∞∆°ng tr√¨nh s·∫Ω b√°o l·ªói NameError ƒë·ªÉ ch·ªâ cho m√¨nh bi·∫øt gi√° tr·ªã n√†y ch∆∞a ƒë∆∞·ª£c ƒë·ªãnh nghƒ©a.

Do ƒë√≥, nguy√™n t·∫Øc LEGB ƒë·ªãnh nghƒ©a th·ª© t·ª± t√¨m ki·∫øm c·ªßa t√™n theo th·ª© t·ª± nh∆∞ sau:

![](https://i0.wp.com/beautyoncode.com/wp-content/uploads/2021/01/1_Wc-YlKPDuImP4_4TGfbt_g.png?w=1280&ssl=1)

V√† th√™m n·ªØa, n·∫øu t√™n ƒë√£ ƒë∆∞·ª£c t√¨m ki·∫øm ·ªü c·∫•p n√†o r·ªìi, th√¨ ch∆∞∆°ng tr√¨nh s·∫Ω d·ª´ng vi·ªác t√¨m ki·∫øm l·∫°i v√† s·ª≠ d·ª•ng t√™n ƒë√≥ ch·ª© kh√¥ng ƒëi t√¨m ·ªü nh·ªØng l·ªõp tr√™n n·ªØa nha, v√¨ t√¨m ra r·ªìi th√¨ d√πng li·ªÅn ch·ªõ h·ªâ.

V√≠ d·ª• nh∆∞ ·ªü tr√™n bi·∫øn a g·ªçi trong h√†m inner_function s·∫Ω c√≥ gi√° tr·ªã l√† 11, ch·ª© ch∆∞∆°ng tr√¨nh kh√¥ng t√¨m ti·∫øp c·∫•p ·ªü ngo√†i, n∆°i a c√≥ gi√° tr·ªã l√† 1 ƒë√≥. 

### K·∫øt

N·ªôi dung b√†i kh√¥ng gian t√™n v√† ph·∫°m vi ƒë·∫øn ƒë√¢y t·∫°m h·∫øt r·ªìi, c√πng √¥n l·∫°i h√¥m ni m√¨nh h·ªçc ƒë∆∞·ª£c g√¨:

- Kh√¥ng gian t√™n s·ª≠ d·ª•ng dict ƒë·ªÉ theo d√µi c√°c ƒë·ªëi t∆∞·ª£ng c√πng ƒë·ªãnh danh c·ªßa ch√∫ng

- Kh√¥ng gian t√™n c√≥ th·ªÉ t·∫°o th√™m hay xo√° b·ªõt m·ªôt c√°ch linh ho·∫°t

- Kh√¥ng gian t√™n c√≥ ranh gi·ªõi ch√≠nh l√† scope, ƒë·ªãnh nghƒ©a ph·∫°m vi t√™n c√≥ th·ªÉ t√¨m th·∫•y

- Th·ª© t·ª± t√¨m t√™n tu√¢n theo lu·∫≠t LEGB(local, enclosing, global, built-in)
