<p>Trước khi tìm hiểu về <code class="language-plaintext highlighter-rouge">scope</code>, <code class="language-plaintext highlighter-rouge">scope chain</code>, hay cả <code class="language-plaintext highlighter-rouge">closures</code>, bạn cần hiểu về <code class="language-plaintext highlighter-rouge">Lexical Environment</code>.</p>

<p>Đây là một khái niệm nền tảng trong JavaScript.</p>

<h2 id="execution-context-và-callstack">Execution Context và Callstack</h2>
<p>Nhắc lại từ bài <a href="https://beautyoncode.com/dieu-gi-xay-ra-khi-chay-mot-chuong-trinh-javascript/https://beautyoncode.com/dieu-gi-xay-ra-khi-chay-mot-chuong-trinh-javascript/">“Điều gì xảy ra khi chạy một chương trình JavaScript ?”</a>, mỗi khi chương trình JavaScript thực thi, sẽ khởi tạo ra các <strong>“Execution Context”</strong></p>

<p>Và có hai giai đoạn của execution context là <strong>“Memory Creation”</strong> và <strong>“Code Execution”</strong>.</p>

<p>Ví dụ có đoạn code sau:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">x</span> <span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">b</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
  <span class="nx">y</span><span class="p">();</span>

  <span class="kd">function</span> <span class="nx">y</span> <span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">c</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nx">x</span><span class="p">();</span>
</code></pre></div></div>

<p>thì sơ đồ mô tả các execution context và callback được tạo với chương trình trên như sau:</p>

<p><img src="https://i2.wp.com/beautyoncode.com/wp-content/uploads/2022/11/ec-callstack.png" alt="" /></p>

<h2 id="lexical-environment--scope-chain">Lexical Environment &amp; Scope Chain</h2>

<p>Mình đã chọn hình cover cho bài viết này là hình ảnh trái đất nhìn từ ngoài vũ trụ, là điểm tương đồng khi nói về lexical environment. Cùng tìm hiểu nhé!</p>

<h3 id="lexical-là-gì">Lexical là gì?</h3>

<p>“Lexical” tiếng anh có nghĩa là sự kết nối từ bên ngoài theo một thứ tự nào đó.</p>

<h3 id="lexical-enviroment-là-gì">Lexical Enviroment là gì?</h3>

<blockquote>
  <p>“Lexical Environment” của hàm bao gồm local memory của hàm đó cộng với “Lexical Environment” của cha nó.</p>
</blockquote>

<p>Ví dụ có hàm <code class="language-plaintext highlighter-rouge">y</code> ở trên nằm lồng trong hàm <code class="language-plaintext highlighter-rouge">x</code> (<code class="language-plaintext highlighter-rouge">y</code> con của <code class="language-plaintext highlighter-rouge">x</code>), và hàm <code class="language-plaintext highlighter-rouge">x</code> nằm bên trong <code class="language-plaintext highlighter-rouge">global scope</code> (<code class="language-plaintext highlighter-rouge">x</code> con của <code class="language-plaintext highlighter-rouge">global</code>).</p>

<p>Hay còn gọi <code class="language-plaintext highlighter-rouge">y is lexically inside the x function. x is lexically inside global</code>.</p>

<p>Ngay khi một <strong>“Execution Context”</strong> khởi tạo, một <strong>“Lexical Environment”</strong> cũng đồng thời được khởi tạo.</p>

<p>Cùng xem parent’s lexical environment tương ứng ở ví dụ trên:</p>

<p><img src="https://i1.wp.com/beautyoncode.com/wp-content/uploads/2022/11/parent-lexical-env.png" alt="" /></p>

<p>Và <code class="language-plaintext highlighter-rouge">Lexical Environment</code> sẽ gồm <code class="language-plaintext highlighter-rouge">local memory</code> và <code class="language-plaintext highlighter-rouge">parent lexical environment</code> được biểu diễn với vòng tròn màu tím bên dưới.</p>

<p><img src="https://i1.wp.com/beautyoncode.com/wp-content/uploads/2022/11/lexical-environment.png" alt="" /></p>

<h2 id="scope-chain">Scope Chain</h2>

<p><strong>Nhìn vào hình trên bạn có thấy được cách chương trình tìm kiếm các giá trị của biến không ?</strong></p>

<p>Thứ tự tìm sẽ từ vòng tím của <code class="language-plaintext highlighter-rouge">y</code> sang vòng tím của <code class="language-plaintext highlighter-rouge">x</code> rồi sang vòng tím của <code class="language-plaintext highlighter-rouge">global</code> và vẫn tìm không thấy thì sẽ gặp <code class="language-plaintext highlighter-rouge">null</code> và kết thúc quá trình tìm kiếm này.</p>

<p>Giả sử tại vòng tím <code class="language-plaintext highlighter-rouge">x</code> không tồn tại <code class="language-plaintext highlighter-rouge">c</code> như trên, thì chương trình sẽ tiếp tục tìm kiếm xem ở các vòng tím <code class="language-plaintext highlighter-rouge">y</code>, rồi đến <code class="language-plaintext highlighter-rouge">global</code>.</p>

<p>Nếu vẫn không tìm thấy sẽ báo lỗi. Nếu có tìm thấy tại đâu trước thì sẽ ưu tiên dùng giá trị tại chỗ đó.</p>

<p>Đây chính là các mà JS Engine tìm kiếm từ trong ra ngoài, gọi là <strong>Scope Chain</strong>.</p>

<p>Hay nói đơn giản hơn <strong>Scope Chain chính là chuỗi nối của các Lexical Environment.</strong></p>

<p>Nếu biến không được tìm thấy ở <code class="language-plaintext highlighter-rouge">local memory</code> của <code class="language-plaintext highlighter-rouge">execution context</code> thì nó sẽ tiến hành tìm kiểm ở các <code class="language-plaintext highlighter-rouge">lexical environment</code> cho đến hết chuỗi thì thôi.</p>

<h2 id="tổng-kết">Tổng kết</h2>

<p>– <code class="language-plaintext highlighter-rouge">Lexical Environment</code> được tạo cùng <code class="language-plaintext highlighter-rouge">Execution Context</code></p>

<p>– <code class="language-plaintext highlighter-rouge">Lexical Environment = local memory + parent’s Lexical Environment</code></p>

<p>– Chain of Lexical Environment gọi là <code class="language-plaintext highlighter-rouge">Scope Chain</code></p>

<hr />

<p>Vậy còn <strong>scope</strong> thì sao ? <strong>Scope</strong> có liên quan đến lexical environment này không ?</p>

<p>Mời các bạn đón đọc bài tiếp theo về <strong>scope</strong> nhé!</p>
